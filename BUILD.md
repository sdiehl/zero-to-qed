# Build System

The HTML and PDF outputs use separate toolchains due to compatibility constraints. HTML is built with mdbook 0.5.2, which supports GitHub-style admonitions (`[!TIP]`, `[!NOTE]`, etc.) that render as styled callout boxes. PDF generation requires mdbook-typst, which only works with mdbook 0.4.52 due to breaking changes in the RenderContext serialization format. The CI workflow handles this by building HTML first with the newer mdbook, then downgrading to build the typst output. Two configuration files control this: `book.toml` (HTML only) and `book-typst.toml` (typst only).

The PDF pipeline has an additional post-processing step. The mdbook-typst renderer escapes LaTeX math delimiters and special characters in ways that break typst compilation. The `mangler.py` script fixes this by converting escaped math (`\$...\$` and `\[...\]`) to mitex function calls (`#mi()` and `#mitex()`), which use the mitex package to render LaTeX math natively in typst. The script also prepends a preamble (`preamble.typst`) containing the title page, legal notice, document styling, theorem environments, admonition boxes, and running headers. After mangling, typst compiles the result to PDF. Run `just pdf` locally or push to main to trigger the full CI build.
